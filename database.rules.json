{
  /* Visit https://firebase.google.com/docs/database/security to learn more about security rules. */
  "rules": {
    ".read": false,
    ".write": false,
    "chats": {
      "$chatId": {
        ".read": "auth != null && ($chatId.contains(auth.uid) || (data.exists() && (auth.uid == data.child('participants').child('0').val() || auth.uid == data.child('participants').child('1').val())))",
        ".write": "auth != null && (auth.uid == newData.child('participants').child('0').val() || auth.uid == newData.child('participants').child('1').val())",
        ".indexOn": ["lastMessageAt", "updatedAt"],
        "messages": {
          ".indexOn": ["timestamp"],
          "$messageId": {
            ".write": "auth != null && auth.uid == newData.child('senderId').val()"
          }
        },
        "typing": {
          "$userId": {
            ".read": "auth != null && (auth.uid == root.child('chats').child($chatId).child('participants').child('0').val() || auth.uid == root.child('chats').child($chatId).child('participants').child('1').val())",
            ".write": "auth != null && auth.uid == $userId"
          }
        }
      }
    },
    "userPresence": {
      "$userId": {
        ".read": "auth != null",
        ".write": "auth != null && auth.uid == $userId",
        ".indexOn": ["lastSeen"]
      }
    },
    "userChats": {
      "$userId": {
        ".read": "auth != null && auth.uid == $userId",
        ".write": "auth != null && auth.uid == $userId"
      }
    }
  }
}
